{% load i18n %}
{% comment %}
<script type="text/javascript">var go_from_select = function (opt) {
    window.location = window.location.pathname + opt
};</script>
<span class="block my-4 text-xs font-semibold text-light-900 dark:text-dark-900">{% blocktrans with title as filter_title %} By {{ filter_title }} {% endblocktrans %}</span>
<ul class="admin-filter-{{ title|cut:' ' }}">
    {% if choices|slice:"4:" %}
    <li>
        <select style="width: 95%;"
                onchange="go_from_select(this.options[this.selectedIndex].value)">
            {% for choice in choices %}
            <option
            {% if choice.selected %} selected="selected"{% endif %}
            value="{{ choice.query_string|iriencode }}">{{ choice.display }}</option>
            {% endfor %}
        </select>
    </li>
    {% else %}
    {% for choice in choices %}
    <li
    {% if choice.selected %} class="selected"{% endif %}>
    <a href="{{ choice.query_string|iriencode }}">{{ choice.display }}</a></li>
    {% endfor %}
    {% endif %}
</ul>
{% endcomment %}

{% with filter_id=title|cut:' ' %}
    <div x-data="{
                open: false,
                toggle() {
                    if (this.open) {
                        this.open = false
                    } else {
                        this.open = true
                    }
                }{% comment %},
                choices: [{% for choice in choices %}{
                    id: {{ forloop.counter }},
                    href: '{{ spec.request.path }}{{ choice.query_string|iriencode|escapejs }}',
                    selected: {% if choice.selected %}true{% else %}false{% endif %},
                    display: '{{ choice.display|escapejs }}'
                 }{% if not forloop.last %},{% endif %}{% endfor %}]{% endcomment %}
            }">
        <label class="block my-4 text-xs font-semibold text-light-900 dark:text-dark-900">{% blocktrans with title as filter_title %} By {{ filter_title }} {% endblocktrans %}</label>
        <div class="relative mt-1">
            <input type="text"
                   placeholder="{% if spec.lookup_val %}{{ spec.lookup_val }}{% else %}{% trans "All" %}{% endif %}"
                   class="w-full rounded-md border border-light-300 dark:border-dark-300 bg-light-0 dark:bg-dark-0 py-2 pl-3 pr-12 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 sm:text-sm"
                   >
            <button x-on:click="toggle()"
                    type="button"
                    class="absolute inset-y-0 right-0 flex items-center rounded-r-md px-2 focus:outline-none">
                <svg class="h-5 w-5 text-light-400 dark:text-dark-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                     fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd"
                          d="M10 3a.75.75 0 01.55.24l3.25 3.5a.75.75 0 11-1.1 1.02L10 4.852 7.3 7.76a.75.75 0 01-1.1-1.02l3.25-3.5A.75.75 0 0110 3zm-3.76 9.2a.75.75 0 011.06.04l2.7 2.908 2.7-2.908a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0l-3.25-3.5a.75.75 0 01.04-1.06z"
                          clip-rule="evenodd"/>
                </svg>
            </button>


            <div class="absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"
                x-show="open"
                x-on:click.outside="open = false"
                style="display: none;">
                    {% comment %}
                    <template x-for="choice in choices" :key="choice.id">
                        <div class="relative cursor-pointer select-none py-2 pl-8 pr-4 text-light-900 dark:text-dark-900">
                            <a :href="choice.href">
                                <span class="block truncate" x-text="choice.display"></span>
                                <template x-if="choice.selected">
                                    <span class="absolute inset-y-0 left-0 flex items-center pl-1.5 text-primary-600">
                                      <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                           aria-hidden="true">
                                        <path fill-rule="evenodd"
                                              d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                                              clip-rule="evenodd"/>
                                      </svg>
                                    </span>
                                </template>
                            </a>
                        </div>
                    </template>
                    {% endcomment %}

                    <div x-ignore>
                        {% for choice in choices %}
                            <a href="{{ spec.request.path }}{{ choice.query_string|iriencode }}" class="block relative cursor-pointer select-none py-2 pl-8 pr-4 text-light-900 dark:text-dark-900">
                                {{ choice.display }}
                                {% if choice.selected %}
                                    <span class="absolute inset-y-0 left-0 flex items-center pl-1.5 text-primary-600">
                                      <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                           aria-hidden="true">
                                        <path fill-rule="evenodd"
                                              d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                                              clip-rule="evenodd"/>
                                      </svg>
                                    </span>
                                {% endif %}
                            </a>
                        {% endfor %}
                    </div>
            </div>
        </div>
    </div>
{% endwith %}
